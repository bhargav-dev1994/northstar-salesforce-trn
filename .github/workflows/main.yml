name: Salesforce Deployment

on:
  push:
    branches:
      - Dev1
      - SIT
      - UAT
      - Master

jobs:
  deploy:
    runs-on: windows-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Set up Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18.x'

      - name: Install Salesforce CLI
        run: |
          echo "Installing Salesforce CLI..."
          npm install -g @salesforce/cli
          echo "Salesforce CLI installed."
          echo "sfdx command location:"
          where sfdx

      - name: Verify Salesforce CLI Installation
        run: |
          sfdx --version
          sfdx plugins --core

      - name: Deploy to Salesforce
        run: |
          echo "Deploying to Salesforce..."
          ant -lib ./lib -f build.xml deploy
        env:
          SF_USERNAME: ${{ secrets.SF_USERNAME_DEV1 }}
          SF_PASSWORD: ${{ secrets.SF_PASSWORD_DEV1 }}
          SF_SERVERURL: ${{ secrets.SF_SERVERURL_SANDBOX }}
